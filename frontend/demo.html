<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAG Chatbot Widget Demo</title>
    <link rel="stylesheet" href="chat-widget.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue',
          Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .demo-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .demo-header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      .demo-header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .demo-header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .demo-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 40px;
      }

      .demo-section {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      }

      .demo-section h2 {
        color: #667eea;
        font-size: 1.5em;
        margin-bottom: 15px;
      }

      .demo-section p {
        color: #666;
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .sample-text {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #667eea;
        font-size: 0.95em;
        line-height: 1.6;
        color: #333;
        margin: 15px 0;
      }

      .sample-text strong {
        color: #667eea;
      }

      .instructions {
        background: #e8f2ff;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
        color: #667eea;
        font-size: 0.95em;
      }

      .code-block {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        margin: 15px 0;
        line-height: 1.5;
      }

      .code-block code {
        display: block;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      #rag-widget {
        height: 500px;
      }

      .demo-footer {
        text-align: center;
        color: white;
        margin-top: 40px;
        padding: 20px;
      }

      .demo-footer a {
        color: #ffd700;
        text-decoration: none;
        font-weight: 600;
      }

      .demo-footer a:hover {
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .demo-content {
          grid-template-columns: 1fr;
        }

        .demo-header h1 {
          font-size: 1.8em;
        }

        #rag-widget {
          height: 400px;
        }
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <div class="demo-header">
        <h1>RAG Chatbot Widget</h1>
        <p>Query books with AI-powered question answering</p>
      </div>

      <div class="demo-content">
        <!-- Chat Widget -->
        <div>
          <div class="demo-section">
            <h2>Chat Widget Demo</h2>
            <p>Try asking questions about the selected book:</p>

            <div id="rag-widget"></div>

            <p style="margin-top: 15px; font-size: 0.9em; color: #999">
              <strong>Try it:</strong>
            </p>
            <ul style="margin-left: 20px; color: #666; font-size: 0.9em">
              <li>Ask a question in Full Book mode</li>
              <li>Select text and click "Ask about this"</li>
              <li>View message history (persists in localStorage)</li>
            </ul>
          </div>
        </div>

        <!-- Instructions -->
        <div>
          <div class="demo-section">
            <h2>How to Use</h2>

            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">Full Book Mode</h3>
            <p>
              Ask questions about any part of the book. The AI will search the entire book and
              return grounded answers with source citations.
            </p>
            <div class="sample-text">
              <strong>Q:</strong> "What are the main themes of this book?"<br />
              <strong>A:</strong> "The book explores... [sources cited]"
            </div>

            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">Selected Text Mode</h3>
            <p>
              Select a passage in the book, click "Ask about this", and ask questions specifically
              about that passage only (zero-leakage constraint).
            </p>
            <div class="sample-text">
              <strong>Selected:</strong> "The quick brown fox jumps over the lazy dog"<br />
              <strong>Q:</strong> "What animals are mentioned?"<br />
              <strong>A:</strong> "Only the selected passage is searched, not the entire book"
            </div>

            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">Features</h3>
            <ul style="margin-left: 20px; color: #666">
              <li>✓ Streaming responses for fast feedback</li>
              <li>✓ Message history with localStorage</li>
              <li>✓ Confidence scores on answers</li>
              <li>✓ Source citations with page numbers</li>
              <li>✓ Responsive design (mobile-friendly)</li>
              <li>✓ Dark mode support</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Integration Guide -->
      <div class="demo-section" style="margin-bottom: 30px">
        <h2>Integration Guide</h2>

        <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">1. Include Scripts</h3>
        <div class="code-block">
          <code>&lt;link rel="stylesheet" href="/frontend/chat-widget.css" /&gt;
&lt;script src="/frontend/utils.js"&gt;&lt;/script&gt;
&lt;script src="/frontend/chat-widget.js"&gt;&lt;/script&gt;</code>
        </div>

        <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">
          2. Add Container Element
        </h3>
        <div class="code-block">
          <code>&lt;div id="chat-widget"&gt;&lt;/div&gt;</code>
        </div>

        <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">3. Initialize Widget</h3>
        <div class="code-block">
          <code>&lt;script&gt;
  const widget = new RAGChatWidget({
    bookId: 'my-book-id',
    containerId: 'chat-widget',
    apiBaseURL: 'https://api.example.com',
    enableStreaming: true,
    enableHistory: true
  });
&lt;/script&gt;</code>
        </div>

        <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">Configuration Options</h3>
        <div class="code-block">
          <code>{
  bookId: string,           // Required: Book to query
  containerId: string,      // Optional: Container element ID
  apiBaseURL: string,       // Optional: API base URL
  enableStreaming: boolean, // Optional: Enable streaming (default: true)
  enableHistory: boolean    // Optional: Save message history (default: true)
}</code>
        </div>

        <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">
          4. Optional: Auto-initialize with Data Attributes
        </h3>
        <div class="code-block">
          <code>&lt;div
  id="my-widget"
  data-rag-widget
  data-book-id="book-123"
&gt;&lt;/div&gt;</code>
        </div>

        <div class="instructions">
          ℹ️ The widget will auto-initialize when the page loads if the container has
          <code>data-rag-widget</code> and <code>data-book-id</code> attributes.
        </div>
      </div>

      <!-- API Requirements -->
      <div class="demo-section" style="margin-bottom: 30px">
        <h2>Backend API Requirements</h2>

        <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">POST /api/chat</h3>
        <div class="code-block">
          <code>Request: {
  query: string,                  // User question
  book_id: string,                // Book to query
  mode: "full" | "selected",      // Query mode
  selected_text?: string          // Optional for "selected" mode
}

Response: {
  response: string,               // Generated answer
  citations: [{
    page_num: number,
    section_name: string,
    chapter_name: string,
    text_snippet: string
  }],
  confidence: number (0-1),       // Confidence score
  latency_ms: number              // Response latency
}</code>
        </div>

        <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px">POST /api/chat-stream</h3>
        <p>Streaming version of /chat endpoint. Returns JSON lines with partial responses.</p>

        <div class="code-block">
          <code>Request: Same as /api/chat

Response (streamed JSON lines):
{"response": "partial text chunk"}
{"response": " more text"}
{"citations": [...]}
{"confidence": 0.92}</code>
        </div>
      </div>

      <div class="demo-footer">
        <p>
          RAG Chatbot Widget • Built with Vanilla JavaScript, Cohere API, and Qdrant Vector DB
        </p>
        <p style="margin-top: 10px; font-size: 0.9em">
          <a href="https://github.com/anthropics/physical-ai-textbook">Source Code</a> •
          <a href="https://docs.cohere.com">Cohere Docs</a> •
          <a href="https://qdrant.tech/documentation">Qdrant Docs</a>
        </p>
      </div>
    </div>

    <script>
      // Initialize widget with demo book
      document.addEventListener('DOMContentLoaded', () => {
        new RAGChatWidget({
          bookId: 'demo-book',
          containerId: 'rag-widget',
          enableStreaming: true,
          enableHistory: true,
        });
      });
    </script>
  </body>
</html>
